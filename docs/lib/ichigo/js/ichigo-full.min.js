!function r(s,i,o){function a(t,e){if(!i[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=i[t]={exports:{}},s[t][0].call(n.exports,function(e){return a(s[t][1][e]||e)},n,n.exports,r,s,i,o)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)a(o[e]);return a}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("../src/ExtensionLoader");const r=e("../src/Html/CreateElement"),s=e("../src/Html/DeleteNodeContent"),i=e("../src/Html/EscapeHtml"),o=e("../src/Html/ExtractNodeContent"),a=e("../src/Html/FindIndexInParent"),l=e("../src/Html/FormFieldValue"),c=e("../src/Html/QuerySelectorNodeList"),u=e("../src/Html/ValidateUniqueDomIds"),h=e("../src/HtmlComponent/BoundComponent"),d=e("../src/HtmlComponent/Component"),p=e("../src/HtmlComponent/ComponentMap"),m=e("../src/Observable/ObservableAssign"),f=e("../src/Observable/ObservableProperty"),y=e("../src/Observable/ObservableProxy"),b=e("../src/Observable/ObservableState"),g=e("../src/Router/PageRouter"),v=e("../src/System/Async/DeferredPromise"),w=e("../src/System/Async/Delay"),_=e("../src/System/Async/RepeatablePromise"),O=e("../src/System/Collections/ArrayUtilities"),E=e("../src/System/Collections/OrderBy"),C=e("../src/System/EventHandler/ArrayChangedEventArgs"),H=e("../src/System/EventHandler/EventHandler"),T=e("../src/System/EventHandler/PropertyChangedEventArgs"),M=e("../src/System/Types/KeywordArguments"),A=e("../src/System/Types/NoneType"),P=e("../src/System/Utility/CloneDeep"),S=e("../src/System/Utility/CloneObject"),L=e("../src/System/Utility/GetUniqueId"),j=e("../src/System/Utility/IsInteger"),N=e("../src/System/Utility/ObjectFullAssign");var x,I,k,D;x={Component:d.Component,BoundComponent:h.BoundComponent,ComponentMap:p.ComponentMap,getComponent:p.getComponent},I={EventHandler:H.EventHandler,observableAssign:m.observableAssign,ObservableProperty:f.ObservableProperty,ObservableProxy:y.ObservableProxy,ObservableState:b.ObservableState,ArrayChangedEventArgs:C.ArrayChangedEventArgs,PropertyChangedEventArgs:T.PropertyChangedEventArgs},k={DeferredPromise:v.DeferredPromise,RepeatablePromise:_.RepeatablePromise},D={PageRouter:g.PageRouter},n={anchor:r.anchor,button:r.button,createElement:r.createElement,createHtml:r.createHtml,createFragment:r.createFragment,deleteNodeContent:s.deleteNodeContent,div:r.div,escapeHtml:i.escapeHtml,extractNodeContent:o.extractNodeContent,findIndexInParent:a.findIndexInParent,getFormFieldValue:l.getFormFieldValue,paragraph:r.paragraph,nodeListSelector:c.nodeListSelector,nodeListSelectorAll:c.nodeListSelectorAll,setFormFieldValue:l.setFormFieldValue,span:r.span,validateUniqueDomIds:u.validateUniqueDomIds},e={array:{cartesian:O.cartesian,range:O.range,traverse:O.traverse,zip:O.zip},cloneDeep:P.cloneDeep,cloneObject:S.cloneObject,delay:w.delay,getUniqueId:L.getUniqueId,html:n,isNone:A.isNone,isPositiveIntegerString:j.isPositiveIntegerString,kw:M.kw,Kwarg:M.Kwarg,objectFullAssign:N.objectFullAssign,orderBy:E.orderBy},window.mi5=window.mi5||{},window.mi5.component=Object.assign(window.mi5.component||{},x),window.mi5.observable=Object.assign(window.mi5.observable||{},I),window.mi5.promise=Object.assign(window.mi5.promise||{},k),window.mi5.router=Object.assign(window.mi5.router||{},D),window.mi5.html=Object.assign(window.mi5.html||{},n),window.mi5.util=Object.assign(window.mi5.util||{},e),window.mi5.using=function(e,t){if(!e||!t)throw new Error("NullArgument");window.eval.call(window,"(function (arg) { window."+t+" = arg; })")(e)}},{"../src/ExtensionLoader":2,"../src/Html/CreateElement":6,"../src/Html/DeleteNodeContent":7,"../src/Html/EscapeHtml":9,"../src/Html/ExtractNodeContent":10,"../src/Html/FindIndexInParent":11,"../src/Html/FormFieldValue":12,"../src/Html/QuerySelectorNodeList":13,"../src/Html/ValidateUniqueDomIds":14,"../src/HtmlComponent/BoundComponent":15,"../src/HtmlComponent/Component":16,"../src/HtmlComponent/ComponentMap":17,"../src/Observable/ObservableAssign":24,"../src/Observable/ObservableProperty":26,"../src/Observable/ObservableProxy":27,"../src/Observable/ObservableState":28,"../src/Router/PageRouter":29,"../src/System/Async/DeferredPromise":30,"../src/System/Async/Delay":31,"../src/System/Async/RepeatablePromise":32,"../src/System/Collections/ArrayUtilities":33,"../src/System/Collections/OrderBy":34,"../src/System/EventHandler/ArrayChangedEventArgs":35,"../src/System/EventHandler/EventHandler":37,"../src/System/EventHandler/PropertyChangedEventArgs":38,"../src/System/Types/KeywordArguments":40,"../src/System/Types/NoneType":41,"../src/System/Utility/CloneDeep":42,"../src/System/Utility/CloneObject":43,"../src/System/Utility/GetUniqueId":44,"../src/System/Utility/IsInteger":45,"../src/System/Utility/ObjectFullAssign":47}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("./Extensions/ObservableExtensions"),e("./Extensions/ComponentExtensions"),e("./Extensions/ElementExtensions")},{"./Extensions/ComponentExtensions":3,"./Extensions/ElementExtensions":4,"./Extensions/ObservableExtensions":5}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../HtmlComponent/Options/IComponentBindingOptions"),s=e("../HtmlComponent/BoundComponent"),i=e("../HtmlComponent/ComponentMap");HTMLElement.prototype.getComponent=function(){return i.ComponentMap.components.get(this)},HTMLElement.prototype.bindComponent=function(e){return new s.BoundComponent(e,new r.ExistingElementBindingOptions({element:this}))},HTMLElement.prototype.deleteComponent=function(){const e=i.ComponentMap.components.get(this);if(e){e instanceof s.BoundComponent&&e.dispose();const t=this.parentNode||document;t.removeChild(this)}else console.error("Not a component")}},{"../HtmlComponent/BoundComponent":15,"../HtmlComponent/ComponentMap":17,"../HtmlComponent/Options/IComponentBindingOptions":18}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Html/CreateElement");HTMLElement.prototype.appendToParent=function(e){return e.appendChild(this),this},HTMLElement.prototype.appendChildFluent=function(e){return this.appendChild(e),this},HTMLElement.prototype.appendSibling=function(e){const t=this.parentNode||document;return t.appendChild(e)},HTMLElement.prototype.appendSiblingFluent=function(e){const t=this.parentNode||document;return t.appendChild(e),this},HTMLElement.prototype.replaceWith=function(e){const t=this.parentNode||document;return t.replaceChild(e,this),e},HTMLElement.prototype.swap=function(e){const t=this.parentNode||document,n=e.parentNode||document;var r=document.createElement("span");return n.replaceChild(r,e),t.replaceChild(e,this),n.replaceChild(this,r),e},HTMLElement.prototype.extract=function(){const e=this.parentNode||document;return e.removeChild(this)},HTMLElement.prototype.addEventListenerFluent=function(e,t,n){return this.addEventListener(e,t,n),this},HTMLElement.prototype.addStyle=function(e,t){return this.style.setProperty(e,t),this},HTMLElement.prototype.addClass=function(e){Array.isArray(e)||(e=[e]);for(const t of[].concat(...e.map(e=>e.split(" ")).filter(e=>e)))this.classList.add(t);return this},DocumentFragment.prototype.createElement=function(e,t,n){t=r.createElement(e,t);return this.appendChild(t),t},DocumentFragment.prototype.createElementFluent=function(e,t,n){t=r.createElement(e,t);return this.appendChild(t),this},DocumentFragment.prototype.appendToParent=function(e){return e.appendChild(this),e}},{"../Html/CreateElement":6}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Observable/ObservableProperty");Object.prototype.toObservable=function(e){return new r.ObservableProperty(this,{name:e})},String.prototype.toObservable=function(e){return new r.ObservableProperty(this,{name:e})},Number.prototype.toObservable=function(e){return new r.ObservableProperty(this,{name:e})},Boolean.prototype.toObservable=function(e){return new r.ObservableProperty(this,{name:e})}},{"../Observable/ObservableProperty":26}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("../System/Types/KeywordArguments"),o=e("./ElementType"),r=e("./ExtractNodeContent");function a(e,t={},n){return{tagName:e,properties:t={},attributes:n}=i.Kwarg.parseArgs({tagName:e,properties:t,attributes:n}),t&&"attributes"in t&&(n=Object.assign(n||{},t.attributes),delete t.attributes),function(e,t={},n){const r=document.createElement(e);if(n)for(const s of Object.getOwnPropertyNames(n))r.setAttribute(s,n[s]);return Object.assign(r,t),r}(e,t,n)}function s(e="",t={},n){return{htmlOrProperties:e="",propertiesOrAttributes:t={},attributes:n}=i.Kwarg.parseArgs({htmlOrProperties:e,propertiesOrAttributes:t,attributes:n}),c(o.elementType.HTMLDivElement,e,t,n)}function l(e="",t={},n){return{htmlOrProperties:e="",propertiesOrAttributes:t={},attributes:n}=i.Kwarg.parseArgs({htmlOrProperties:e,propertiesOrAttributes:t,attributes:n}),c(o.elementType.HTMLSpanElement,e,t,n)}function c(e,t="",n={},r){return t instanceof HTMLElement?function(e,t,n,r){const s=a(e,n,r);return s.appendChild(t),s}(e,t,n,r):"object"==typeof t?(s=e,o=n,(i=(i=t)||{}).innerHTML=i.innerHTML||"",a(s,i,o)):(e=e,t=String(t||""),r=r,(n=(n=n)||{}).innerHTML=t,a(e,n,r));var s,i,o}n.createElement=a,n.createHtml=function(e,t=!1){let n;return n=(t?l:s)((e||"").trim()),1!==n.childNodes.length?n:n.firstElementChild||(t?n:l(n.innerHTML))},n.createFragment=function(e){return e=s((e||"").trim()),r.extractNodeContent(e)},n.div=s,n.span=l,n.paragraph=function(e="",t={},n){return{htmlOrProperties:e="",propertiesOrAttributes:t={},attributes:n}=i.Kwarg.parseArgs({htmlOrProperties:e,propertiesOrAttributes:t,attributes:n}),c(o.elementType.HTMLParagraphElement,e,t,n)},n.anchor=function(e="",t={},n={},r){({htmlOrProperties:e="",hrefOrProperties:t={},propertiesOrAttributes:n={},attributes:r}=i.Kwarg.parseArgs({htmlOrProperties:e,hrefOrProperties:t,propertiesOrAttributes:n,attributes:r}));const s=c(o.elementType.HTMLAnchorElement,e,n,r);return"string"==typeof t&&(s.href=String(t||"")),s},n.button=function(e="",t={},n){return{htmlOrProperties:e="",propertiesOrAttributes:t={},attributes:n}=i.Kwarg.parseArgs({htmlOrProperties:e,propertiesOrAttributes:t,attributes:n}),c(o.elementType.HTMLButtonElement,e,t,n)}},{"../System/Types/KeywordArguments":40,"./ElementType":8,"./ExtractNodeContent":10}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.deleteNodeContent=function(e){const t=document.createRange();t.selectNodeContents(e),t.deleteContents()}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),(n=n.elementType||(n.elementType={})).HTMLAnchorElement="a",n.HTMLAreaElement="area",n.HTMLAudioElement="audio",n.HTMLBRElement="br",n.HTMLBaseFontElement="basefont",n.HTMLBlockQuoteElement="blockquote",n.HTMLButtonElement="button",n.HTMLCanvasElement="canvas",n.HTMLDataElement="data",n.HTMLDataListElement="datalist",n.HTMLDialogElement="dialog",n.HTMLDivElement="div",n.HTMLDListElement="dl",n.HTMLEmbedElement="embed",n.HTMLFieldSetElement="fieldset",n.HTMLFormElement="form",n.HTMLHeading1Element="h1",n.HTMLHeading2Element="h2",n.HTMLHeading3Element="h3",n.HTMLHeading4Element="h4",n.HTMLHeading5Element="h5",n.HTMLHeading6Element="h6",n.HTMLHRElement="hr",n.HTMLImageElement="image",n.HTMLInputElement="input",n.HTMLLabelElement="label",n.HTMLLegendElement="legend",n.HTMLLIElement="li",n.HTMLLinkElement="link",n.HTMLMapElement="map",n.HTMLMeterElement="meter",n.HTMLModDelElement="del",n.HTMLModInsElement="ins",n.HTMLOListElement="ol",n.HTMLObjectElement="object",n.HTMLOptGroupElement="optgroup",n.HTMLOptionElement="option",n.HTMLOutputElement="output",n.HTMLParagraphElement="p",n.HTMLParamElement="param",n.HTMLPictureElement="picture",n.HTMLPreElement="pre",n.HTMLProgressElement="progress",n.HTMLQuoteElement="q",n.HTMLScriptElement="script",n.HTMLSelectElement="select",n.HTMLSourceElement="source",n.HTMLSpanElement="span",n.HTMLStyleElement="style",n.HTMLTableCaptionElement="caption",n.HTMLTableDataCellElement="td",n.HTMLTableHeaderCellElement="th",n.HTMLTableColElement="col",n.HTMLTableColGroupElement="colgroup",n.HTMLTableElement="table",n.HTMLTableRowElement="tr",n.HTMLTableSectionBodyElement="tbody",n.HTMLTableSectionFooterElement="tfoot",n.HTMLTableSectionHeaderElement="thead",n.HTMLTemplateElement="template",n.HTMLTextAreaElement="textarea",n.HTMLTimeElement="time",n.HTMLTrackElement="track",n.HTMLUListElement="ul",n.HTMLVideoElement="video"},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.escapeHtml=function(e){if(!e)return e;const t={"<":"&lt;",">":"&gt;","&":"&amp;","/":"&#x2F;","=":"&#x3D;",'"':"&quot;","'":"&#39;","`":"&#x60;"};return e.replace(/[&<>"'`=\/]/g,e=>t[e])}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.extractNodeContent=function(e){const t=document.createRange();return t.selectNodeContents(e),t.extractContents()}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.findIndexInParent=function(e){var t=e.parentElement;if(t)return Array.from(t.children).indexOf(e)}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const h=e("../System/Types/NoneType");function r(e){return!!e.checked}function s(e){if(e.value)return Number(e.value)}function i(e){return e.name?(document.querySelector(`input[name="${e.name}"]:checked`)||{}).value:e.checked?e.value:void 0}function o(e){return e.multiple?a(e):e.value}function a(e){return Array.from(e.selectedOptions).filter(e=>e.value).map(e=>e.value)}n.getFormFieldValue=function(e){if("input"!==e.tagName.toLowerCase())return"select"===e.tagName.toLowerCase()?o(e):"textarea"===e.tagName.toLowerCase()?e.value:void 0;{const t=e;return"checkbox"===t.type.toLowerCase()?r(t):"number"===t.type.toLowerCase()?s(t):"radio"===t.type.toLowerCase()?i(t):t.value}},n.getCheckboxValue=r,n.getNumberInputValue=s,n.getRadioValue=i,n.getSelectValue=o,n.getMultiSelectValue=a,n.getSimpleFormValue=function(e){if("select"===e.tagName.toLowerCase()&&e.multiple)throw new Error("Not valid for multi-selects");return e.value},n.setFormFieldValue=function(n,e){const t=(e=h.isNone(e)?"":e).toString();if("input"===n.tagName.toLowerCase()){const o=n;var r=o.type.toLowerCase();if("checkbox"===r)o.checked=!0===e||"true"===t.toLowerCase();else if("radio"===r)o.checked=t===o.value;else if("date"===r)e&&(o.value=i(new Date(t)));else if("datetime"===r||"datetime-local"===r){if(e){const a=new Date(t);isNaN(a.valueOf())||(o.value=`${i(a)}T${function(e){if(!isNaN(e.valueOf()))return"";var t=("0"+e.getHours()).slice(-2),e=("0"+e.getMinutes()).slice(-2);return`${t}:${e}`}(a)}`)}}else o.value=t}else if("select"===n.tagName.toLowerCase()){const l=n,c=Array.from(l.options);if(l.multiple){if(!Array.isArray(e))return s(c,e),void(l.value=t);e.map(e=>{s(c,e)});for(const u of c)u.selected=-1<e.map(e=>e.toString()).indexOf(u.value)}else s(c,e),l.value=t}else"textarea"===n.tagName.toLowerCase()?n.value=t:console.warn(`Called setFormFieldValue on non-form field ${n.tagName} ${n.id||""}`);function s(e,t){-1<e.map(e=>e.value).indexOf(t.toString())||console.warn(`Called setFormFieldValue with nonexistent option ${t.toString()} on select ${n.id}`)}function i(e){if(!isNaN(e.valueOf()))return"";var t=("0"+(e.getUTCMonth()+1).toString()).slice(-2),n=("0"+e.getUTCDate().toString()).slice(-2);return`${e.getUTCFullYear()}-${t}-${n}`}}},{"../System/Types/NoneType":41}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.nodeListSelector=function(e,t){for(const r of e)if("matches"in r){if(r.matches(t))return r;var n=r.querySelector(t);if(n)return n}},n.nodeListSelectorAll=function(e,t){const n=[];for(const s of e){var r;"matches"in s&&(s.matches(t)&&n.push(s),r=s.querySelectorAll(t),n.push(...Array.from(r)))}return n}},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateUniqueDomIds=function(){const e=new Set;let t=0;for(const n of document.querySelectorAll("*[id]"))if(e.add(n.id),t++,e.size!==t)throw new Error(`Duplicate DOM IDs found. The first duplicate id is ${n}.`)}},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Html/CreateElement"),a=e("../Html/ElementType"),r=e("../Html/EscapeHtml"),l=e("../Html/ExtractNodeContent"),i=e("../Html/FormFieldValue"),s=e("../Html/QuerySelectorNodeList"),c=e("../Observable/IObservable"),u=e("../Observable/ObservableProperty"),h=e("../Observable/ObservableState"),d=e("../System/Types/Constructable"),p=e("../System/Types/NoneType");var m=e("./Component");const f=e("./ComponentMap"),y=e("../System/Types/KeywordArguments");class BoundComponent extends m.Component{constructor(e,t){super(t),this._attributeBindings=[],this._writeTargets=[],this._cssClassSwitches=[],this._replacements=[],this._async=!1,this._defer=!1,this._initialized=!1,this.viewModel=e;try{window.customElements.get("i-v")||window.customElements.define("i-v",b)}catch(e){}t=t||{};if(this._async=t.async||!1,this._defer=t.defer||!1,this._name=t.name,t.loopItemClass){if(!d.constructorTypeGuard(t.loopItemClass))throw new Error("loopItemClass is not a constructor");if(!(t.loopItemClass instanceof BoundComponent.constructor))throw new Error("loopItemClass is not an bound component")}if(this._loopItemClass=t.loopItemClass||BoundComponent,this._configureComponentBindings(),this.setTemplate(this.content.innerHTML),t.observeAllViewModel?this.observeAll():t.observeViewModel&&this.observe(),t.observeTargets)for(const n of t.observeTargets)this.observe(n);if(t.observeAllTargets)for(const r of t.observeAllTargets)this.observeAll(r);this._async?setTimeout(()=>this.render(),0):this.render(),this._initialized=!0}static inject(e="[ichigo]",t,n,r){({selector:e="[ichigo]",options:t,constructor:n,viewModel:r}=y.Kwarg.parseArgs({selector:e,options:t,constructor:n,viewModel:r}));const s=n||this,i=this._getOptions(t||{});return this._inject(e,i,e=>this._replaceElementWithBoundComponent(e,r,i,s),e=>this._convertElementToBoundComponent(e,r,i,s))}static injectBind(e,t="[ichigo]",n,r){return{selector:t="[ichigo]",options:n,constructor:r,viewModel:e}=y.Kwarg.parseArgs({selector:t,options:n,constructor:r,viewModel:e}),this.inject(t,n,r,e)}static _replaceElementWithBoundComponent(e,t,n,r){n=new r(t,this._mergePropertiesAndAttributes(e,n));return this._replaceElement(e,n),n}static _convertElementToBoundComponent(e,t,n,r){return new r(t,Object.assign({element:e},n))}write(e){if(this._writeTargets.length){e=e.currentTarget;if(e){const r=i.getFormFieldValue(e);if(void 0!==r)for(const n of this._writeTargets)if(n.startsWith("this."))t(this[n],()=>this[n]=r,this);else if("."===n)h.observableStateCheck(this.viewModel)?this.viewModel.value=r:t(this.viewModel,()=>this.viewModel=r,this.viewModel);else if("object"==typeof this.viewModel)if(h.observableStateCheck(this.viewModel)){const s=this.viewModel.value;t(s[n],()=>s[n]=r,s),this.viewModel.value=s}else t(this.viewModel[n],()=>this.viewModel[n]=r,this.viewModel);function t(e,t,n){"function"!=typeof e?u.observablePropertyCheck(e)?e.value=r:t():e.call(n,r)}}}}observe(e){return e=e||this.viewModel,c.observableCheck(e)&&e.subscribe(this.render,this),this}observeAll(e){if(!(e=e||this.viewModel))return this;this.observe(e);for(const t of Object.getOwnPropertyNames(e))this.observe(e[t]);return this}render(){if(this._defer&&!this._initialized)return this;for(const i of this._attributeBindings)if(i.bool){let e=this._getUntypedValue(i.source);e=i.negative?!e:!!e,e?this.content.setAttribute(i.attribute,e):this.content.removeAttribute(i.attribute)}else this.content.setAttribute(i.attribute,this._getStringValue(i.source)||"");this._valueAttribute&&(this.value=this._getUntypedValue(this._valueAttribute)),this._cssClasses&&(this.content.className=this._getStringValue(this._cssClasses)||"");for(const o of this._cssClassSwitches){let e=!!this._getUntypedValue(o.source);o.negative&&(e=!e),e?this.content.classList.add(o.class):this.content.classList.remove(o.class)}var e;if(this._cssStyle&&(e=this._getStringValue(this._cssStyle)||"",(this.content.style.cssText=e)&&!this.content.style.cssText&&console.warn(`Invalid style text in component: ${e}`)),this._loop){var t=this._getUntypedValue(this._loop.source);if(t&&"function"==typeof t[Symbol.iterator]){var n=l.extractNodeContent(this.content);for(const a of t){var r=document.importNode(this._loop.fragment,!0),s=Array.from(r.childNodes).slice();this.content.appendChild(r),this._loop.postProcess&&this.loopPostProcess(a,s,t,n)}}}if(this._cssDisplay){let e=this._getUntypedValue(this._cssDisplay.source);this._cssDisplay.negative&&(e=!e),e?this.content.style.setProperty("display",this._previousCssDisplaySetting||""):("none"!==this.content.style.display&&(this._previousCssDisplaySetting=this.content.style.display||void 0),this.content.style.setProperty("display","none"))}return this._updateHtmlReplacements(),this}setTemplate(e,t=!1){if(!e)return this;if(t&&!this._initialized)throw new Error("Update should not be true when called internally.");const n=o.createElement(a.elementType.HTMLTemplateElement);n.innerHTML=e;const r=document.importNode(n.content,!0);this._replacements.length=0;for(const i of r.querySelectorAll("i-v")){var s;!this._name&&0<i.attributes.length&&Array.from(i.attributes).filter(e=>"noescape"!==e.name&&!e.value).length&&console.warn(`Unnamed component #${this.content.id} contains possibly named I-V replacement intended for another component: <i-v ${Array.from(i.attributes).filter(e=>"noescape"!==e.name&&!e.value)[0].name}>${i.innerHTML}</i-v>`),this._name&&!i.hasAttribute(this._name)||(s=i.hasAttribute("noescape")&&"false"!==i.getAttribute("noescape"),this._replacements.push({element:i,source:i.innerHTML,noescape:s}))}return this._initialized||this._defer||(this._defer=this._defer||!!this._replacements.find(e=>e.source.startsWith("this."))),this._defer&&!this._initialized||this._updateHtmlReplacements(),this._replacements.length&&(this.content.innerHTML="",this.content.appendChild(r)),t&&this.render(),this}setHtmlTemplate(e=".",t=!1){return this.setTemplate("<i-v noescape>"+e+"</i-v>",t)}setTextTemplate(e=".",t=!1){return this.setTemplate("<i-v>"+e+"</i-v>",t)}setLoop(e=".",t,n=!1,r=!1){if(!e||!t)throw new Error("Invalid arguments");return"string"==typeof t&&(t=o.createFragment(t)),this._loop={source:e,postProcess:!n,fragment:t},r&&this.render(),this}removeLoop(e=!1){return this._loop=void 0,e&&this.render(),this}setValueAttribute(e=".",t=!1){return this._valueAttribute=e,t&&this.render(),this}setVisibility(e=".",t=!1,n=!1){return this._cssDisplay=e?{source:e,negative:t}:void 0,n&&this.render(),this}addAttributeMapping(t,e=".",n=!1){if(!e||!t)throw new Error("Invalid arguments");return this._attributeBindings.find(e=>e.attribute===t)||this._attributeBindings.push({attribute:t,source:e,bool:!1,negative:!1}),n&&this.render(),this}addBooleanAttributeMapping(t,e=".",n=!1,r=!1){if(!e||!t)throw new Error("Invalid arguments");return this._attributeBindings.find(e=>e.attribute===t)||this._attributeBindings.push({attribute:t,source:e,bool:!0,negative:n}),r&&this.render(),this}removeAttributeMapping(t,e=!1){if(!t)throw new Error("Invalid argument");var n=this._attributeBindings.filter(e=>e.attribute!==t);return this._attributeBindings.length=0,this._attributeBindings.push(...n),e&&this.render(),this}setCssClass(e=".",t=!1){return this._cssClasses=e,t&&this.render(),this}setCssStyle(e=".",t=!1){return this._cssStyle=e,t&&this.render(),this}addCssClassSwitch(t,e=".",n=!1,r=!1){if(!t||!e)throw new Error("Invalid arguments");return this._cssClassSwitches.find(e=>e.class===t)||this._cssClassSwitches.push({class:t,source:e,negative:n}),r&&this.render(),this}removeCssClassSwitch(t,e=!1){if(!t)throw new Error("Invalid argument");var n=this._cssClassSwitches.filter(e=>e.class!==t);return this._cssClassSwitches.length=0,this._cssClassSwitches.push(...n),e&&this.render(),this}addWriteEvent(){return this.content.addEventListener("input",this.write.bind(this)),this}addWriteTarget(t=".",e=!1){if(!t)throw new Error("Invalid argument");return this._writeTargets.find(e=>e===t)||this._writeTargets.push(t),e&&this.render(),this}removeWriteTarget(t,e=!1){if(!t)throw new Error("Invalid argument");var n=this._writeTargets.filter(e=>e!==t);return this._writeTargets.length=0,this._writeTargets.push(...n),e&&this.render(),this}autoInject(e){if(e)BoundComponent.injectBind(this.viewModel,e,{parent:this.content});else for(const t of this.content.querySelectorAll("*"))for(const n of Array.from(t.attributes))if(n.name.startsWith("i5_")||n.name.startsWith(":")||n.name.startsWith("data-i5_")){BoundComponent.injectBind(this.viewModel,t);break}return this}dispose(){f.ComponentMap.components&&f.ComponentMap.components.delete(this.content)}loopPostProcess(e,t,n,r){this._loopItemClass.injectBind(e,s.nodeListSelectorAll(t,"[i5_item], [\\00003Aitem], [data-i5_item]"),{replace:!1,loopParent:this,async:this._async})}_getStringValue(e,t=!1){const n=this._getUntypedValue(e);return p.isNone(n)?n:"string"==typeof n?t?n:r.escapeHtml(n):t?n.toString():r.escapeHtml(n.toString())}_getUntypedValue(t){let n;if(t){let e=this.viewModel;if(h.observableStateCheck(e)&&(e=e.value),t.startsWith("this.")){if(e=this,!((t=t.slice(5))in this))return void console.warn(`this.${t} does not exist on view.`);n=this[t]}else if("."===t)n=e;else if("object"==typeof e){if(!(t in e))return console.warn(`this.${t} does not exist on viewModel.`),{};n=e[t]}return"function"==typeof n?n.call(e):u.observablePropertyCheck(n)?n.value:n}}_updateHtmlReplacements(){for(const t of this._replacements){var e=this._getStringValue(t.source,t.noescape)||"";const n=t.element;e!==n.innerHTML&&(n.innerHTML=e)}}_configureComponentBindings(){const e=Array.from(this.content.attributes).filter(e=>e.value||"i5_input"===e.name||":input"===e.name).map(e=>({name:e.name,value:e.value||""}));for(const i of Object.getOwnPropertyNames(this.content.dataset)){var t=this.content.dataset[i];!t&&"i5_input"!==i||e.push({name:i,value:t||""})}let n=!1;for(const o of e){var r=this._parseAttributeName(o.name);let e=!1;if(r)switch(r.type){case"name":this._name=this._name||o.value;break;case"boolNegative":e=!0;case"bool":if(!r.detail)throw new Error("Programming error");this.addBooleanAttributeMapping(r.detail,o.value,e),s.call(this);break;case"attr":if(!r.detail)throw new Error("Programming error");this.addAttributeMapping(r.detail,o.value),s.call(this);break;case"switchClassNegative":e=!0;case"switchClass":if(!r.detail)throw new Error("Programming error");this.addCssClassSwitch(r.detail,o.value,e),s.call(this);break;case"text":if(n)throw new Error("Can't set i5_text and i5_html at same time");n=!0,this.content.innerHTML=`<i-v>${o.value}</i-v>`,s.call(this);break;case"html":if(n)throw new Error("Can't set i5_text and i5_html at same time");n=!0,this.content.innerHTML=`<i-v noescape>${o.value}</i-v>`,s.call(this);break;case"value":this.setValueAttribute(o.value),s.call(this);break;case"ifNegative":e=!0;case"if":this.setVisibility(o.value,e),s.call(this);break;case"style":this.setCssStyle(o.value),s.call(this);break;case"class":this.setCssClass(o.value),s.call(this);break;case"input":if(this.addWriteEvent(),!o.value)break;r.detail&&this.setValueAttribute(o.value);case"target":this.addWriteTarget(o.value),s.call(this);break;case"loop":this.setLoop(o.value,l.extractNodeContent(this.content),"null"===r.detail),s.call(this);break;case"item":break;default:throw new Error("Not Implemented Ichigo attribute: "+r.type)}function s(){this._defer=this._defer||o.value.startsWith("this.")}}}_parseAttributeName(t){if(t.startsWith(":"))t="i5_"+t.slice(1);else{if("i5_item"===t)return;if("i5_event"===t)return;if(!t.startsWith("i5_"))return}if(t.startsWith("i5_attr")){if(":"!==t[7]&&"_"!==t[7])throw new Error("Invalid attribute binding syntax");if(t.length<9)throw new Error("Binding attribute name is missing.");return{type:"attr",detail:t.slice(8)}}if(t.startsWith("i5_bool")){let e=!1;if(":"!==t[7]&&"_"!==t[7]&&"-"!==t[7]&&"0"!==t[7])throw new Error("Invalid attribute binding syntax");if("-"!==t[7]&&"0"!==t[7]||(e=!0,t=t.slice(0,7)+t.slice(8)),t.length<9)throw new Error("Binding attribute name is missing.");return{type:e?"boolNegative":"bool",detail:t.slice(8)}}if(t.startsWith("i5_switch")){let e=!1;if(":"!==t[9]&&"_"!==t[9]&&"-"!==t[9]&&"0"!==t[9])throw new Error("Invalid switch binding syntax");if("-"!==t[9]&&"0"!==t[9]||(e=!0,t=t.slice(0,9)+t.slice(10)),t.length<11)throw new Error("Class switch name is missing.");return{type:e?"switchClassNegative":"switchClass",detail:t.slice(10)}}if(t.startsWith("i5_if")){let e=!1;return"-"!==t.slice(-1)&&"0"!==t.slice(-1)||(e=!0),{type:e?"ifNegative":"if"}}return t.startsWith("i5_loop")?"i5_loop:null"===t?{type:"loop",detail:"null"}:{type:"loop"}:t.startsWith("i5_target")?{type:"target"}:t.startsWith("i5_input")?{type:"input",detail:t.endsWith("_value")||t.endsWith(":")?"2way":""}:{type:t.slice(3)}}}n.BoundComponent=BoundComponent;class b extends HTMLElement{constructor(){super()}}n.TemplateReplacementValue=b},{"../Html/CreateElement":6,"../Html/ElementType":8,"../Html/EscapeHtml":9,"../Html/ExtractNodeContent":10,"../Html/FormFieldValue":12,"../Html/QuerySelectorNodeList":13,"../Observable/IObservable":19,"../Observable/ObservableProperty":26,"../Observable/ObservableState":28,"../System/Types/Constructable":39,"../System/Types/KeywordArguments":40,"../System/Types/NoneType":41,"./Component":16,"./ComponentMap":17}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const a=e("../Html/CreateElement"),s=e("../Html/ElementType"),r=e("../Html/FormFieldValue"),i=e("../Html/QuerySelectorNodeList"),o=e("../System/Types/KeywordArguments"),l=e("../System/Utility/GetUniqueId"),c=e("./ComponentMap");n.Component=class{constructor(e){this.content=null,e&&"string"==typeof e?function(e){r.call(this,{outerHtml:e})}.call(this,e):e&&e.selector?(e.innerHtml&&(e.properties=Object.assign(e.properties||{},{innerHTML:e.innerHtml})),function(e){var t=(e.parent||document).querySelector(e.selector);if(!t)throw new Error("Element selector could not find element.");e.element=t,n.call(this,e)}.call(this,e)):e?e.element?(e.innerHtml&&(e.properties=Object.assign(e.properties||{},{innerHTML:e.innerHtml})),n.call(this,e)):(e.outerHtml?r:function(e){var t={innerHTML:e.innerHtml||""};Object.assign(t,e.properties),this.content=a.createElement(e.type||s.elementType.HTMLDivElement,t,e.attributes),e.id?this.content.id=e.id:this.content.id||(this.content.id=l.getUniqueId())}).call(this,e):function(){this.content=a.createElement(s.elementType.HTMLDivElement,{id:l.getUniqueId()})}.call(this),this._checkInlineEventListeners();try{var t="iv_"+this.constructor.name.charAt(0).toLowerCase()+this.constructor.name.slice(1).replace(/\W+/g," ").replace(/([a-z])([A-Z])([a-z])/g,"$1 $2$3").split(/\B(?=[A-Z]{2,})/).join(" ").split(" ").join("_").toLowerCase();this.content.setAttribute(t,"")}catch(e){}function n(e){if(this.content=e.element,e.attributes)for(const t of Object.getOwnPropertyNames(e.attributes))this.content.setAttribute(t,e.attributes[t]);e.properties&&Object.assign(this.content,e.properties)}function r(e){var t=a.div(e.outerHtml.trim());if(1!==t.childNodes.length||!t.firstElementChild)throw new Error("OuterHtml must contain exactly one HTMLElement");if(this.content=t.firstElementChild,e.attributes)for(const n of Object.getOwnPropertyNames(e.attributes))this.content.setAttribute(n,e.attributes[n]);e.properties&&Object.assign(this.content,e.properties),e.id&&(this.content.id=e.id)}this.mapComponent()}static inject(e="[ichigo]",t,n){({selector:e="[ichigo]",options:t,constructor:n}=o.Kwarg.parseArgs({selector:e,options:t,constructor:n}));const r=n||this,s=this._getOptions(t);return this._inject(e,s,e=>this._replaceElementWithComponent(e,s,r),e=>this._convertElementToComponent(e,r))}static _inject(e="[ichigo]",t,n,r){const s=[];var i=this._lookUpContainersToInject(e,t.parent);for(const o of i)t.replace?(1<i.length&&(delete t.id,"properties"in t&&delete t.properties.id,"attributes"in t&&delete t.attributes.id),s.push(n(o))):s.push(r(o));return s}static _mergePropertiesAndAttributes(e,t){const n={innerHTML:e.innerHTML},r={};for(const i of Array.from(e.attributes))r[i.name]=i.value;const s=Object.assign({},t);if(s.outerHtml){t=a.div(s.outerHtml.trim());if(1!==t.childNodes.length||!t.firstElementChild)throw new Error("OuterHtml must contain exactly one HTMLElement");t=t.firstElementChild;delete n.innerHTML;for(const o of Array.from(t.attributes))o.name in r&&delete r[o.name]}return s.properties=Object.assign(n,s.properties),s.attributes=Object.assign(r,s.attributes),s}static _getOptions(e){let t;return t=e&&"string"==typeof e?{replace:!0,outerHtml:e}:e||{replace:!1},t}static _replaceElement(e,t){(e.parentNode||document).replaceChild(t.content,e)}static _replaceElementWithComponent(e,t,n){this._mergePropertiesAndAttributes(e,t);t=new n(t);return this._replaceElement(e,t),t}static _convertElementToComponent(e,t){return new t({element:e})}static _lookUpContainersToInject(e="[ichigo]",t){null===e&&console.warn("Injection selector is null."),e=e||"[ichigo]";let n;return n=t&&"string"==typeof e?(t=t||document,Array.from(t.querySelectorAll(e))):"string"==typeof e?Array.from(document.querySelectorAll(e)):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e],n}get id(){return this.content.id}set id(e){this.content.id=e}get innerHTML(){return this.content.innerHTML}set innerHTML(e){this.content.innerHTML=e}get value(){return r.getFormFieldValue(this.content)}set value(e){r.setFormFieldValue(this.content,e)}get className(){return this.content.className}set className(e){this.content.className=e}get classList(){return this.content.classList}get style(){return this.content.style}addEventListener(e,t,n){return this.content.addEventListener(e,t,n),this}addInlineEventListeners(e){for(const t of i.nodeListSelectorAll([this.content],"[i5_event], [\\00003Aevent], [data-i5_event]"))if(!e||t.getAttribute("component")===e){const n=Array.from(t.attributes);let e=n.find(e=>e.name.startsWith("(")&&e.name.endsWith(")")&&2<e.name.length);if(e=e||n.find(e=>e.name.startsWith("_")&&e.name.endsWith("_")&&2<e.name.length),!e||!e.value)throw new Error(`Event definition not declared for element ${t.id||t.tagName}`);const r=this[e.value];if("function"!=typeof r)throw new Error(`Handler method for element ${t.id||t.tagName} ${e.value} does not exist`);t.addEventListener(e.name.slice(1,-1),r.bind(this))}return this}append(e){var t;return(t=e)&&"content"in t&&t.content instanceof Node?this.content.appendChild(e.content):this.content.appendChild(e),this}appendChild(e){return(t=e)&&"content"in t&&t.content instanceof Node?this.content.appendChild(e.content):this.content.appendChild(e);var t}appendToParent(e){var t;return((t=e)&&"content"in t&&t.content instanceof Node?e.content:e).appendChild(this.content),this}mapComponent(){if(c.getComponent(this.content))throw new Error("Content already referenced by a component");return c.ComponentMap.components.set(this.content,this),this}unmapComponent(){return c.ComponentMap.components.delete(this.content),this}*getAllChildComponents(){for(const t of this.content.querySelectorAll("*")){var e=c.getComponent(t);e&&(yield e)}}setStyle(e,t){if("string"==typeof e&&t)this.content.style.setProperty(e,t);else for(const r of Object.getOwnPropertyNames(e)){var n=e[r];this.content.style.setProperty(r,n)}return this}addClass(e){if(!e)return this;"string"==typeof e&&e.includes(" ")?e=e.split(" ").filter(e=>""!==e):"string"==typeof e&&(e=[e]);for(const t of e)this.content.classList.add(t);return this}_checkInlineEventListeners(){for(const e of i.nodeListSelectorAll([this.content],"[i5_event], [\\00003Aevent], [data-i5_event]"))window.__event_warning__||(console.info("Inline event listeners are configured. Remember to call addInlineEventListeners()."),window.__event_warning__=!0),setTimeout(()=>delete window.__event_warning__,1e3)}}},{"../Html/CreateElement":6,"../Html/ElementType":8,"../Html/FormFieldValue":12,"../Html/QuerySelectorNodeList":13,"../System/Types/KeywordArguments":40,"../System/Utility/GetUniqueId":44,"./ComponentMap":17}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class r{}r.components=new WeakMap,n.ComponentMap=r,n.getComponent=function(e){return"string"!=typeof e||(e=document.getElementById(e))?r.components.get(e):void 0}},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class r{constructor(e){Object.assign(this,e)}}(class extends(n.ComponentBindingOptions=r){});n.ExistingElementBindingOptions=class extends r{constructor(e){super(e),Object.assign(this,e),this.element=e.element}};n.ExistingLookupBindingOptions=class extends r{constructor(e){super(e),Object.assign(this,e),this.selector=e.selector}};n.InnerHtmlBindingOptions=class extends r{constructor(e){super(e),Object.assign(this,e)}};n.OuterHtmlBindingOptions=class extends r{constructor(e){super(e),Object.assign(this,e),this.outerHtml=e.outerHtml}}},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../System/EventHandler/EventHandler");n.observableCheck=function(e){return e&&"object"==typeof e&&"changeHandler"in e&&e.changeHandler instanceof r.EventHandler}},{"../System/EventHandler/EventHandler":37}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const o=e("../../System/EventHandler/ArrayChangedEventArgs"),r=e("../../System/Utility/ObjectFullAssign");class s extends e("../ObservableBase").ObservableBase{constructor(e){super({name:"ArrayProxy",disableAsync:e})}}class i extends Array{constructor(...e){super(...e)}static getMergedObservable(e,t){e=new i(...e),t=r.objectFullAssign(e,new s(t));return Object.defineProperty(t,"changeHandler",{enumerable:!1}),t}static get[Symbol.species](){return Array}publishCollectionChanged(e,t,n,r,s,i){this.changeHandler.invoke(new o.ArrayChangedEventArgs({type:e,propertyName:t,args:n,oldValue:r,newValue:s,sender:i}))}toJSON(){return this.slice()}}n.ArrayObservable=i},{"../../System/EventHandler/ArrayChangedEventArgs":35,"../../System/Utility/ObjectFullAssign":47,"../ObservableBase":25}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const o=e("../../System/Utility/IsInteger");class r{get(s,i,o){if(i in s){const a=Reflect.get(s,i,o);return-1===r.methodsToWatch.indexOf(i.toString())?a:(...e)=>{var t=s.slice(),n=a.apply(s,e),r=s.slice();return s.publishCollectionChanged("call",i,e,t,r,o),n}}}set(e,t,n,r){if(!t||"length"!==t.toString()&&"number"!=typeof t&&!o.isPositiveIntegerString(t))return Reflect.set(e,t,n,r),!0;var s=e.slice();Reflect.set(e,t,n,r);var i=e.slice();return e.publishCollectionChanged("set",t,[n],s,i,r),!0}deleteProperty(e,t){var n=e.slice();Reflect.deleteProperty(e,t);var r=e.slice();return e.publishCollectionChanged("delete",t,[],n,r,null),!0}}r.methodsToWatch=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],n.ArrayProxyHandler=r},{"../../System/Utility/IsInteger":45}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("../../System/EventHandler/PropertyChangedEventArgs");var r=e("../ObservableBase");const s=e("../../System/Utility/ObjectFullAssign");class o extends r.ObservableBase{static getMergedObservable(e,t){t=s.objectFullAssign(e,new o(t),!0);return Object.defineProperty(t,"changeHandler",{enumerable:!1}),t}constructor(e){super({name:"ObjectProxy",disableAsync:e})}publishPropertyChanged(e,t,n,r,s){this.changeHandler.invoke(new i.PropertyChangedEventArgs({type:e,propertyName:t,oldValue:n,newValue:r,sender:s}))}toJSON(){return super.toJSON()}}n.ObjectObservable=o},{"../../System/EventHandler/PropertyChangedEventArgs":38,"../../System/Utility/ObjectFullAssign":47,"../ObservableBase":25}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ObjectProxyHandler=class{constructor(e,t,n,r){this._methodsToWatch=e,this._watchSet=t,this._watchDelete=n,this._triggerOnlyOnChange=r}get(n,r,s){if(r in n){const i=Reflect.get(n,r,s);return-1===this._methodsToWatch.indexOf(r.toString())||"function"!=typeof i?i:(...e)=>{var t=i.apply(n,e);return n.publishPropertyChanged("call",r,void 0,e,s),t}}}set(e,t,n,r){if(this._watchSet){var s=Reflect.get(e,t,r);return(Reflect.set(e,t,n,r),this._triggerOnlyOnChange&&s===n)?!0:(e.publishPropertyChanged("set",t,s,n,r),!0)}return Reflect.set(e,t,n,r),!0}deleteProperty(e,t){if(this._watchDelete){var n=Reflect.get(e,t);return Reflect.deleteProperty(e,t),e.publishPropertyChanged("delete",t,n,void 0,null),!0}return Reflect.deleteProperty(e,t),!0}}},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const o=e("./ObservableProperty");n.observableAssign=function(t,...e){t=t||{};for(const r of e)for(const s of Object.getOwnPropertyNames(r)){var n=r[s];const i=t[s];let e;e=o.observablePropertyCheck(n)?n.value:n,o.observablePropertyCheck(i)?i.value=e:t[s]=e}}},{"./ObservableProperty":26}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("../System/EventHandler/EventHandler");n.ObservableBase=class{constructor({name:e,forwardTo:t,bubbleFrom:n,disableAsync:r}={}){if(this.changeHandler=new i.EventHandler,r&&(this.changeHandler=new i.EventHandler(!0)),t&&this.sendChangeEventsTo(t),n)for(const s of n)this.receiveChangeEventsFrom(s);this.tagDelegate(e)}subscribe(e,t){return this.changeHandler.subscribe(e,t)}sendChangeEventsTo(e){this.subscribe(e.changeHandler.delegate)}receiveChangeEventsFrom(e){e.subscribe(this.changeHandler.delegate)}unsubscribeCallback(e){return this.changeHandler.unsubscribeCallback(e)}unsubscribeSender(e){return this.changeHandler.unsubscribeListener(e)}unsubscribeDelegate(e){return this.changeHandler.unsubscribeDelegate(e)}tagDelegate(e){e&&(this.changeHandler.delegate._tag=e)}dispose(){this.changeHandler.dispose()}toJSON(){const e={};for(const t in this)"changeHandler"!==t&&"privateProperty2"!==t&&(e[t]=this[t]);return e}}},{"../System/EventHandler/EventHandler":37}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Html/EscapeHtml"),i=e("../System/EventHandler/PropertyChangedEventArgs"),s=e("../System/Types/NoneType"),o=e("../System/Utility/IsPrimitive"),a=e("./IObservable");class l extends e("./ObservableBase").ObservableBase{constructor(e,t={}){super(t),this.propertyName="",this._triggerOnlyOnChange=!1,t=t||{},this._value=e,this.propertyName=t.name||"",this._triggerOnlyOnChange=t.onlyWhenChanged||!1}get value(){return this._value}set value(e){var t=this._value;this._value=e,this._triggerOnlyOnChange&&t===e||this.publishPropertyChanged("set",this.propertyName,t,e,this)}get safeValue(){return s.isNone(this._value)||!o.isPrimitive(this._value)?"":r.escapeHtml(String(this._value))}toString(){return JSON.stringify(this._value)}toJSON(){return this._value}publishPropertyChanged(e,t,n,r,s){this.changeHandler.invoke(new i.PropertyChangedEventArgs({type:e,propertyName:t,oldValue:n,newValue:r,sender:s}))}}n.ObservableProperty=l,n.observablePropertyCheck=function(e){return!!a.observableCheck(e)&&(e&&e instanceof l)}},{"../Html/EscapeHtml":9,"../System/EventHandler/PropertyChangedEventArgs":38,"../System/Types/NoneType":41,"../System/Utility/IsPrimitive":46,"./IObservable":19,"./ObservableBase":25}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./Internal/ArrayObservable"),s=e("./Internal/ArrayProxyHandler"),o=e("./Internal/ObjectObservable"),a=e("./Internal/ObjectProxyHandler");class l{static proximate(e,t,n){if("function"==typeof e)throw new Error("Unsupported type: function");return Array.isArray(e)?this.proximateArray(e,t,n):"object"==typeof e?this.proximateObject(e,t,n):this.proximateObject({value:e},t,n)}static proximateObject(e,t,n,r=[],s=!0,i=!0){if("function"==typeof e)throw new Error("Unsupported type: function");t=o.ObjectObservable.getMergedObservable(e,t),n=new a.ObjectProxyHandler(r||[],s||!1,i||!1,n||!1),n=new Proxy(t,n);return l._models.set(n,t),n}static proximateArray(e,t,n){e=r.ArrayObservable.getMergedObservable(e,t),t=new s.ArrayProxyHandler,t=new Proxy(e,t);return l._models.set(t,e),t}}l._models=new WeakMap,n.ObservableProxy=l},{"./Internal/ArrayObservable":20,"./Internal/ArrayProxyHandler":21,"./Internal/ObjectObservable":22,"./Internal/ObjectProxyHandler":23}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Html/EscapeHtml"),i=e("../System/EventHandler/PropertyChangedEventArgs"),s=e("../System/Types/NoneType"),o=e("../System/Utility/CloneDeep"),a=e("../System/Utility/IsPrimitive"),l=e("./IObservable");class c extends e("./ObservableBase").ObservableBase{constructor(e,t={}){super(t),this.propertyName="",e instanceof c?this._value=o.cloneDeep(e.value):this._value=o.cloneDeep(e),this.propertyName=(t=t||{}).name||"setState"}get value(){return o.cloneDeep(this._value)}set value(e){this.setState(e,!0)}getSafeValue(e){if(!e)return!s.isNone(this._value)&&a.isPrimitive(this._value)?r.escapeHtml(String(this._value)):"";e=this.value[e];return s.isNone(e)||!a.isPrimitive(e)?"":r.escapeHtml(String(e))}getValue(e){return e?this.value[e]:!s.isNone(this._value)&&a.isPrimitive(this._value)?o.cloneDeep(this._value):void 0}getState(){return this.value}setState(e,t=!1){var n=o.cloneDeep(this._value);let r,s;if(a.isPrimitive(this._value)){if("function"==typeof e)throw new Error("Cannot call setState with a function if state is primitive.");t=!0}if(t)r=function(e){return this._value=o.cloneDeep(e),e}.call(this,e);else if("function"==typeof e)[r,s]=function(e){var t=o.cloneDeep(this._value),e=e.call(t,t);return this._value=o.cloneDeep(t),[t,e]}.call(this,e);else{if(!e||"object"!=typeof e)throw new Error("value is not a partial state or a function");r=function(e){const t=o.cloneDeep(this._value);for(const n of Object.getOwnPropertyNames(e))t[n]=e[n];return this._value=o.cloneDeep(t),t}.call(this,e)}return this.publishPropertyChanged("call",this.propertyName,n,r,this),{oldValue:n,newValue:r,returnValue:s}}toString(){return JSON.stringify(this._value)}toJSON(){return this.value}publishPropertyChanged(e,t,n,r,s){this.changeHandler.invoke(new i.PropertyChangedEventArgs({type:e,propertyName:t,oldValue:n,newValue:r,sender:s}))}}n.ObservableState=c,n.observableStateCheck=function(e){return!!l.observableCheck(e)&&(e&&e instanceof c)}},{"../Html/EscapeHtml":9,"../System/EventHandler/PropertyChangedEventArgs":38,"../System/Types/NoneType":41,"../System/Utility/CloneDeep":42,"../System/Utility/IsPrimitive":46,"./IObservable":19,"./ObservableBase":25}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Html/CreateElement"),i=e("../Html/DeleteNodeContent"),s=e("../Html/ElementType"),a=e("../System/Collections/ArrayUtilities"),o=e("../System/Types/Constructable"),l=e("../System/Types/KeywordArguments"),c=e("../System/Types/NoneType");class u{static get allRoutes(){return this._routes}static get matchedRoute(){return this._matchedRoute||{route:"",params:new Map,config:{route:""}}}static get params(){return this.matchedRoute.params}static get historyMaxLength(){return this._historyMaxLength}static set historyMaxLength(e){this._history.length>e&&(this._history.length=e),this._historyMaxLength=e}static get history(){return this._history}static set notFound(e){this._notFound=e}static configure(e=[],t,n,r,s,i=!0){({routes:e,defaultLayout:t,defaultStaticLayout:n,notFound:r,defaultRoute:s,urlRoutingEnabled:i=!0}=l.Kwarg.parseArgs({routes:e,defaultLayout:t,defaultStaticLayout:n,notFound:r,defaultRoute:s,urlRoutingEnabled:i})),this._configured=!0,r&&(this._notFound=r);for(const o of e)t&&(o.layout=o.layout||t),!c.isNone(n)&&c.isNone(o.staticLayout)&&(o.staticLayout=n),this.addRoute(o);i&&this.turnOnUrlRouting(),this.routeContainer=document.querySelector("page-router")||document.body;try{window.customElements.get("page-router")||window.customElements.define("page-router",h,{extends:"div"}),window.customElements.get("layout-body")||window.customElements.define("layout-body",d,{extends:"div"}),window.customElements.get("not-found")||window.customElements.define("not-found",p,{extends:"div"})}catch(e){}s&&this.defaultRoute(s)}static addRoute(e){let t;t=Array.isArray(e.route)?e.route:[e.route];for(const n of t){if(this._routes.find(e=>e.route===n))throw new Error("Route already exists.");const r=Object.assign({},e);r.route=n,this._routes.push(r)}}static defaultRoute(e){window.location.hash?u.route():u.route(e)}static route(e,t=!0){if(!this._configured)throw new Error("PageRouter not configured. Call configure() first.");if(e)t&&(window.location.hash=e),this._lastRoute=e;else if((e=window.location.hash.slice(1))===this._lastRoute)return void(this._lastRoute=void 0);let n,r=!1;for(const i of this._routes)if(r=this._testRoute(i.route,e||""),r){n=i;break}if(!n)return console.log(`Route ${e} not found.`),void this._renderNotFound();t=(this._matchedRoute||{}).config;this._matchedRoute={route:e,params:r||new Map,config:n},0!==this.history.length&&this.history[this.history.length-1]===e||this._history.push(e),this.history.length>this.historyMaxLength&&this._history.shift();let s=[];Array.isArray(n.routeGuards)?s=n.routeGuards:n.routeGuards&&s.push(n.routeGuards);for(const o of s)if(!1===o.checkValid(n))return void console.warn("Route permission denied");this._renderRoute(n,t)}static back(){var e;this.history.length<2||(this._history.pop(),void 0!==(e=this._history.pop())&&this.route(e))}static turnOnUrlRouting(){this._hashChange=e=>{this.route()},window.addEventListener("hashchange",this._hashChange)}static _testRoute(t,e){const n=new Map;if(!t||!e)return!1;(t=t.toLowerCase()).endsWith("/")&&(t=t.slice(0,-1)),e.endsWith("/")&&(e=e.slice(0,-1));var r,s,i=t.split("/"),e=e.split("/");if(i.length!==e.length)return!1;for([r,s]of a.zip(i,e))if(r.startsWith(":")){let e=r.slice(1);if(e.includes("=")){var o=e.split("=")[1];if(e=e.split("=")[0],o!==s)return!1;if(n.has(e))throw new Error(`Route ${t} contains duplicates of the same parameter.`);n.set(e,s)}else{if(n.has(e))throw new Error(`Route ${t} contains duplicates of the same parameter.`);n.set(e,s)}}else if(r!==s.toLowerCase())return!1;return n}static _renderRoute(t,e){let n=this.routeContainer;e=t.layout&&e&&t.staticLayout&&t.layout===e.layout;if(e||i.deleteNodeContent(n),e){if(n=document.querySelector("layout-body"),!n)throw new Error("<layout-body> element not found")}else if(t.layout){let e;if(o.constructorTypeGuard(t.layout)?e=new t.layout:t.payload&&(e=t.layout()),e&&s(e)?n.appendChild(e.content):e&&n.appendChild(e),n=document.querySelector("layout-body"),!n)throw new Error("<layout-body> element not found")}e&&i.deleteNodeContent(n);let r;function s(e){return"content"in e&&e.content instanceof HTMLElement}o.constructorTypeGuard(t.payload)?r=new t.payload:"function"==typeof t.payload?r=t.payload():t.payload&&(r=t.payload.cloneNode(!0)),r&&s(r)?n.appendChild(r.content):r&&n.appendChild(r)}static _renderNotFound(){i.deleteNodeContent(this.routeContainer),this.routeContainer.appendChild(r.createElement(s.elementType.HTMLDivElement,{id:"not-found",innerHTML:this._notFound||"Quoth the Raven, 404"}))}}u.routeContainer=document.body,u._configured=!1,u._routes=[],u._history=[],u._historyMaxLength=50,n.PageRouter=u;class h extends HTMLElement{constructor(){super()}}class d extends HTMLElement{constructor(){super()}}class p extends HTMLElement{constructor(){super()}}},{"../Html/CreateElement":6,"../Html/DeleteNodeContent":7,"../Html/ElementType":8,"../System/Collections/ArrayUtilities":33,"../System/Types/Constructable":39,"../System/Types/KeywordArguments":40,"../System/Types/NoneType":41}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.DeferredPromise=class{constructor(e,t=!1){this.throwOnUnhandledError=t,this.resolve=function(){},this.reject=function(){},this._promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}),e?this.then(e,t):this.then(e=>e,t)}get output(){return this._promise}then(e,t=this.throwOnUnhandledError){return e&&(this._promise=this._promise.then(e)),t&&(this._promise=this._promise.catch(e=>{throw e})),this}catch(e,t=this.throwOnUnhandledError){return e&&(this._promise=this._promise.catch(e)),t&&(this._promise=this._promise.catch(e=>{throw e})),this}}},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.delay=function(n){return t=>new Promise(e=>setTimeout(()=>e(t),n))}},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./DeferredPromise");n.RepeatablePromise=class{constructor(e,t,n=!1){this.onUnhandledError=t,this.throwOnUnhandledError=n,this.callbacks=[],e?this.then(e):this.then(e=>e)}resolve(e){const t=this.build();return t.resolve(e),t.output}reject(e){const t=this.build();return t.reject(e),t.output}then(e){return this.callbacks.push({onfulfilled:e}),this}catch(e){return this.callbacks.push({onrejected:e}),this}build(){let e;for(const t of this.callbacks)if(e)t.onfulfilled?e.then(t.onfulfilled):t.onrejected&&e.catch(t.onrejected);else{if(!t.onfulfilled)throw new Error("Bug in RepeatablePromise constructor. First onfulfilled is null.");e=new r.DeferredPromise(t.onfulfilled,!1)}if(!e)throw new Error("Bug in RepeatablePromise constructor. No callbacks, not even the default first onfulfilled.");return this.onUnhandledError&&e.catch(this.onUnhandledError),this.throwOnUnhandledError&&e.catch(e=>{throw e}),e}}},{"./DeferredPromise":30}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.zip=function(n,r){return n.length>=r.length?n.map((e,t)=>[e,r[t]]):r.map((e,t)=>[n[t],r])},n.cartesian=function(e,t){const n=[];for(const r of e)n.push(...t.map(e=>[r,e]));return n},n.range=function(e){return Array.from({length:e},(e,t)=>t)};n.traverse=function*e(t){if(Array.isArray(t))for(const n of t)yield*e(n);else yield t}},{}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.orderBy=function(n){return function(e,t){e=n(e),t=n(t);return e<t?-1:t<e?1:0}}},{}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ArrayChangedEventArgs=class{constructor(e){this.type="",this.propertyName="",this.args=[],Object.assign(this,e)}}},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Async/RepeatablePromise");n.Delegate=class{constructor(e,t){if(t||console.warn("Delegate created without thisArg. Did you mean to?"),(this.thisArg=t)&&"object"==typeof t&&"constructor"in t&&(this.callbackOwnerName=t.constructor.name),!e)throw new Error("callback is required");if("function"!=typeof e)throw new Error("callback must be a callback function");this.callback=e,this.callbackName=e.name,this.callbackOwnerName&&this.callbackName?this.name=`${this.callbackOwnerName}.${this.callbackName}()`:this.callbackName?this.name=this.callbackName+"()":this.callbackOwnerName&&(this.name=this.callbackOwnerName+".__lambda__()"),this.promise=new r.RepeatablePromise(e.bind(t))}}},{"../Async/RepeatablePromise":32}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Collections/ArrayUtilities"),r=e("./Delegate");n.EventHandler=class{constructor(e=!1){this._disableAsync=e,this.delegate=[]}subscribe(e,t){if(Array.isArray(e))(function(t){this.delegate.find(e=>e===t)||this.delegate.push(t)}).call(this,e);else if(!this.find({callback:e,thisArg:t,firstMatch:!0}).length){t=new r.Delegate(e,t);return this.delegate.push(t),this._disableAsync?void 0:t.promise}}unsubscribeCallback(t){var e=this.delegate.findIndex(e=>!Array.isArray(e)&&e.callback===t);0<=e&&this.delegate.splice(e,1)}unsubscribeListener(t){"delegate"in t&&this.unsubscribeDelegate(t.delegate);let e=0;for(;0<=e;)e=this.delegate.findIndex(e=>!Array.isArray(e)&&e.thisArg===t),0<=e&&this.delegate.splice(e,1)}unsubscribeDelegate(t){let e=0;for(;0<=e;)e=this.delegate.findIndex(e=>e===t),0<=e&&this.delegate.splice(e,1)}invoke(e){for(const t of i.traverse(this.delegate))this._disableAsync?t.callback.call(t.thisArg,e):t.promise.resolve(e)}find({callback:t,thisArg:n,firstMatch:e}={}){const r=[];for(const s of i.traverse(this.delegate))if(function(e){if(t&&n)return e.callback===t&&e.thisArg===n;if(t)return e.callback===t;if(n)return e.thisArg===n;return!0}(s)&&(r.push(s),e))break;return r}clear(){this.delegate.length=0}dispose(){this.clear(),this.delegate=void 0}}},{"../Collections/ArrayUtilities":33,"./Delegate":36}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.PropertyChangedEventArgs=class{constructor(e){this.type="",Object.assign(this,e)}}},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.constructorTypeGuard=function(e){return e&&e.prototype&&e.prototype.constructor.name}},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const h=e("../Utility/IsInteger");class d{constructor(e,t){if(!e)throw new Error("Argument null exception");this.name=e,this.value=t}static parseArgs(e,t=!1){const n={};var r=Object.getOwnPropertyNames(e);for(const l of r)e[l]instanceof d?n[l]=void 0:n[l]=e[l];const s={};n.$$kw$$=s;const i=[];n.$rest$=i;for(const c of Object.getOwnPropertyNames(e).filter(e=>h.isPositiveIntegerString(e)))e[c]instanceof d||i.push(e[c]);const o={};for(const u of r)if(e[u]instanceof d){var a=e[u];if(a.name in n)n[a.name]=a.value;else{if(!t)throw new Error(`Got an unexpected keyword argument '${a.name}'`);s[a.name]=a.value}if(a.name in o)throw new Error(`Got multiple values for keyword argument + '${a.name}'`);o[a.name]=!0}return n}static unpack(e){const t=[];for(const n of Object.getOwnPropertyNames(e))t.push(r(n,e[n]));return t}isMatch(e){return this.name===e}}function r(e,t){if(!e)throw new Error("Argument null exception");if("string"==typeof e)return new d(e,t);if(Array.isArray(e))return new d(e[0],e[1]);t=Object.getOwnPropertyNames(e);if(!t.length)throw new Error("Argument null exception");if(1<t.length)throw new Error("Invalid map object: multiple keys");return new d(t[0],e[t[0]])}n.Kwarg=d,n.kw=r,n.kwargsToObject=function(e){const t={};for(const n of e)t[n.name]=t[n.value];return t}},{"../Utility/IsInteger":45}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isNone=function(e){return null==e||void 0===e}},{}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.cloneDeep=function n(e,r=new WeakMap){if(Object(e)!==e)return e;if(r.has(e))return r.get(e);let s;e instanceof Set?(s=new Set,Array.from(e,e=>s.add(n(e,r)))):e instanceof Map?(s=new Map,Array.from(e,([e,t])=>s.add(n(e,r),n(t,r)))):s=Array.isArray(e)?Array.from(e):e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):"function"==typeof e?new Function("return "+e.toString())():Object.getPrototypeOf(e)?Object.create(Object.getPrototypeOf(e)):Object.create(null),r.set(e,s);for(const i of Object.getOwnPropertyNames(e)){var t=Object.getOwnPropertyDescriptor(e,i);t&&!1===t.writable||("function"!=typeof e[i]||i in s?t&&(t.get||t.set)?Object.defineProperty(s,i,t):s[i]=n(e[i],r):t&&(Object.defineProperty(s,i,t),r.set(e[i],s[i])))}return s}},{}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.cloneObject=function(e){if(e&&"object"==typeof e){var t=Object.create(Object.getPrototypeOf(e));for(const r of Object.getOwnPropertyNames(e)){var n=Object.getOwnPropertyDescriptor(e,r);n&&Object.defineProperty(t,r,n)}return t}}},{}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Collections/ArrayUtilities");n.getUniqueId=function(){var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_";let t="u"+String((new Date).getTime())+"-";for(const n of r.range(8))t+=e.charAt(Math.floor(Math.random()*e.length));return t}},{"../Collections/ArrayUtilities":33}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isPositiveIntegerString=function(e){return!(!e||"string"!=typeof e)&&("0"===e||/^[1-9]\d*$/.test(e))}},{}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isPrimitive=function(e){return Object(e)!==e}},{}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("./CloneObject"),o=e("../Types/NoneType");n.objectFullAssign=function(e,t,n=!1){if(o.isNone(e)&&(e={}),!t||"object"!=typeof t||"object"!=typeof e)return e;n&&(e=i.cloneObject(e));for(const s of Array.from(new Set(function e(t){const n=[];n.push(...Object.getOwnPropertyNames(t).filter(e=>"constructor"!==e));var t=Object.getPrototypeOf(t);t&&"Object"!==t.constructor.name&&n.push(...e(t));return n}(t)))){var r=function e(t,n){var r=Object.getOwnPropertyDescriptor(t,n);if(r)return r;var t=Object.getPrototypeOf(t);if(t&&"Object"!==t.constructor.name)return e(t,n)}(t,s);r&&Object.defineProperty(e,s,r)}return e}},{"../Types/NoneType":41,"./CloneObject":43}]},{},[1]);